<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>天气和时间</title>
    <script>
        function getWeather(city) {
            var api_url = "http://api.xn--7gqa009h.top/api/tianqi?msg=" + city;
            var iframe = document.createElement("iframe");
            iframe.setAttribute("src", api_url);
            iframe.style.display = "none";
            iframe.onload = function() {
                var response = iframe.contentDocument.body.innerText;
                var result = JSON.parse(response);
                document.getElementById("weather").innerText = "天气：" + result.weather + "，温度：" + result.temperature + "℃";
            };
            document.body.appendChild(iframe);
        }
        
        window.onload = function() {
            // 获取用户所在城市
            var url = "https://api.map.baidu.com/location/ip?ak=您的AK&coor=bd09ll&callback=?";
            $.getJSON(url, function(result) {
                var city = result.content.address_detail.city;
                city = city.slice(0, -1); // 去掉最后的"市"
                getWeather(city);
            });
            
            // 更新当前时间
            setInterval(function() {
                var now = new Date();
                var hour = now.getHours();
                if (hour < 10) {
                    hour = "0" + hour;
                }
                var minute = now.getMinutes();
                if (minute < 10) {
                    minute = "0" + minute;
                }
                var second = now.getSeconds();
                if (second < 10) {
                    second = "0" + second;
                }
                var timeString = hour + ":" + minute + ":" + second;
                document.getElementById("time").innerText = "当前时间：" + timeString;
            }, 1000);
        };
    </script>
</head>
<body>
    <h1>天气和时间</h1>
    <p id="weather"></p>
    <p id="time"></p>
</body>
</html>
